{% extends 'base.html' %}

{% block title %}{{ activitydraft.name }}{% endblock title %}

{% block stylesheet %}
<style>
    #map {
        height: 400px;
        width: 80%;
   }
</style>
{% endblock %}

{% block content %}

<!--<iframe width="600" height="450" frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/place?q=place_id:ChIJYdawkGNg1moRrmgS6XeT7AM&key=AIzaSyAMBqqtl6cnrNdV4TUGDSF4z9g4shpp5kM" allowfullscreen></iframe>-->

<div class="card">
  <div class="card-body">
    <h4 class="card-title">{{ activitydraft.name }}</h4>
    <p class="card-text">{{ activitydraft.description }}</p>
    <p class="card-text">{{ activitydraft.activity_type }}</p>
    <p class="card-text">{{ activitydraft.organiser }}</p>
    <p class="card-text">Where? <a href=# id="address">{{ activitydraft.location }}</a></p>  
    
      
<!--    Activities that only occur once -->
    {% if activitydraft.activity_date %}
        <p class="card-text">{{ activitydraft.activity_date|date:'D, d M Y' }}</p>
        <p class="card-text">{{ activitydraft.start_time|time:'g:i A' }} to {{ activitydraft.end_time|time:'g:i A' }}</p>
    {% endif %}
    
<!--      Daily, weekly, fortnightly, monthly activities-->
    {% if activitydraft.term != 'Once' %}
      {% if activitydraft.activity_day %}
      <p class="card-text">Happening every {{ activitydraft.activity_day }} from {{ activitydraft.start_date|date:'D, d M Y' }} to {{ activitydraft.end_date|date:'D, d M Y' }}</p>
      {% else %}
      <p class="card-text">Happening every day from {{ activitydraft.start_date|date:'D, d M Y' }} to {{ activitydraft.end_date|date:'D, d M Y' }}</p>
      {% endif %}
      
<!--      Show the time of the activities-->
      <p class="card-text">{{ activitydraft.start_time|time:'g:i A' }} to {{ activitydraft.end_time|time:'g:i A' }}</p>
    {% endif %}
      
    <!--      Number of available spaces-->
      {% if activitydraft.space_choice == 'Limited' %}
        <p class="card-text">Available space: {{ activitydraft.space }}</p>
      {% endif %}
      
<!--      Activity cost-->
      {% if activitydraft.cost_choice == 'N' %}
        <p class="card-text">No cost</p>
      {% endif %}
      {% if activitydraft.cost_choice == 'Y' %}
        <p class="card-text">Cost: ${{ activitydraft.cost }}</p>
      {% endif %}
      
<!--      Eligibility-->
      {% if activitydraft.living_duration != 'Open' %}
      <p class="card-text">Living in Australia {{ activitydraft.living_duration|lower }} than 5 years </p>      
      {% endif %}
      
      {% if activitydraft.living_duration == 'Open' %}
      <p class="card-text">Open to anyone</p>
      {% endif %}
      
    <a href="{% url 'edit_draft_activity' activitydraft.pk %}" class="btn btn-outline-primary">Edit</a>
    <a href="{% url 'submit_activity' activitydraft.pk %}" class="btn btn-outline-primary">Publish</a>
      
  </div>
</div>
<br/>

{% if activitydraft.location %}
<div class="row justify-content-center">
  <div id="map"></div>
</div>
{% endif %}

{% endblock %}

{% block javascript %}

<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDuR6-6PfCU7wRsSRRR3DH_PseEAYvyp3k&callback=initMap">
</script>

<!--
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"
    async defer>
</script>
-->

<script>

function initMap() {
  var geocoder = new google.maps.Geocoder();

  var map = new google.maps.Map(document.getElementById('map'));

  var address = $('#address').text();

  geocodeAddress(geocoder, map);

  var map_url = "https://www.google.com/maps/search/?api=1&query=";
  var full_url = map_url + address;

  $("#address").attr("href", full_url);

}

function geocodeAddress(geocoder, resultsMap) {
  var address = $('#address').text();
  // var address = 'Southern Cross Station';
  // alert(address);
  geocoder.geocode({'address': address}, function(results, status) {
    if (status === 'OK') {
      resultsMap.setCenter(results[0].geometry.location);
      resultsMap.setZoom(14);
      var marker = new google.maps.Marker({
        map: resultsMap,
        position: results[0].geometry.location
      });
    } 
    // else {
    //   alert('Geocode was not successful for the following reason: ' + status);
    // }
  });
}
</script>

{% endblock %}