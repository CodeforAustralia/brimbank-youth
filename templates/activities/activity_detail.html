{% extends 'base.html' %}

{% load static %}

{% load social_share %}

{% block title %}{{ activity.name }}{% endblock title %}

{% block stylesheet %}
<!-- <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" /> -->
<!-- <link rel="stylesheet" href="{% static 'css/fontawesome-all.css'%}"> -->
<link rel="stylesheet" type="text/css" href="{% static 'css/jssocials.css'%}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/jssocials-theme-flat.css'%}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/slick.css'%}"/>
<link rel="stylesheet" type="text/css" href="{% static 'css/slick-theme.css'%}"/>
<!-- <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.css" /> -->
<!-- <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials-theme-flat.css" /> -->

<style>
  #map {
    height: 500px;
    width: 100%;
  }
  #fb_desktop {
    border-radius: 0%;
  }
  button {
    cursor: pointer;
  }
  #id_others {
    background-color: rgb(233, 227, 227);
    padding-top: 0.5em;
    padding-bottom: 2em;
  }
  .btn.focus {
    outline-color: transparent;
  }
  .btn.active {
    background-color:rgb(92,184,92);
  }
  .js-bookmark-article {
    background: transparent;
    border-color: grey;
  }
  #edit_btn {
    background: lightgrey;
    color: grey;
    border-color: transparent;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
<div class="card">
  <row style="border-bottom:solid 0.5px LightGray;border-bottom:solid 0.5px LightGray;">
    <div class="row">
    <div class="col-md-9">
      {% if activity.activity_img %}
      <img class="card-img-top select" src="{{ activity.activity_img.url }}" alt="Not Found" onerror="this.onerror=null;this.src='http://via.placeholder.com/350x300?text=Image not available';" style="object-fit:cover;margin:auto;height:400px;display:inline;">
      {% else %}
      <img class="card-img-top select" src="http://via.placeholder.com/350x300?text=Image not available" alt="Not Found" style="object-fit: cover;display:inline;margin:auto;height:400px;">
      {% endif %}
    </div>
    <div class="col-md-3 mt-5">
      <!--    Activities that only occur once -->
      {% if activity.term == 'Once' %}
      {% if activity.activity_date %}
      <h4 class="strong"><b>{{ activity.activity_date|date:'M'|upper }} {{ activity.activity_date|date:'d, Y' }}</b></h4>
      {% endif %}
      {% endif %}

      <!--    Weekly, daily, fortnightly, monthly activities -->
      {% if activity.term != 'Once' %}
      {% if activity.term == 'Daily' %}
      <!-- <h4 class="strong"><b> -->
        <!-- {{ activity.start_date|date:'M'|upper }} {{ activity.start_date|date:'d, Y' }} to {{ activity.start_date|date:'M'|upper }}  {{ activity.start_date|date:'d, Y' }}</b></h4> -->
      
      <h4 class="strong ml-2"><b>EVERY DAY</b></h4>
      {% else %}
      <h4 class="strong ml-2"><b>EVERY {{ activity.activity_day|upper }}</b></h4>
      {% endif %}
      {% endif %}

      <h4 class="mt-5 ml-2"><a href="{% url 'activity_detail' activity.pk %}">{{ activity.name|upper }}</a></h4>
      <p class="ml-2">By: {{ activity.created_by.profile.organisation_name }}</p>
      {% if activity.cost_choice == 'N' %}
        <h6 class="strong mt-5 ml-2">FREE!</h6>
      {% endif %}
      {% if activity.cost_choice == 'Y' %}
        <h6 class="strong mt-5 ml-2">Cost: AUD {{ activity.cost }}</h6>
      {% endif %}
    </div>
    </div>
  </row>

  <row style="border-bottom:solid 0.5px LightGray;border-bottom:solid 0.5px LightGray;">
    <div class="row" >
      <div class="col-md-7 mt-4 mb-4">
        <a href="#" class="btn btn-outline-primary ml-4 mr-2 js-share-url"><i class="fas fa-share"></i> Share</a>
        <!-- Bookmark button -->
        {% if user.is_authenticated %}
        {% if activity.bookmarked %}
        {% for bookmark_user in activity.bookmarked_users.all %}
        {% if bookmark_user.username == user.username %}
        <button onclick="markActivity(this.id)" id={{ activity.id }} type="button" class="btn js-bookmark-article active mr-2" data-url="#" data-toggle="button" aria-pressed="false" autocomplete="off">
            <i class="far fa-bookmark"></i>
        </button>
        {% endif %}
        {% endfor %}
        {% endif %}
        <button onclick="markActivity(this.id)" id={{ activity.id }} type="button" class="btn js-bookmark-article remove mr-2" data-url="#" data-toggle="button" aria-pressed="false" autocomplete="off">
            <i class="far fa-bookmark"></i>
        </button>
        {% endif %}
        <!-- End of bookmark button -->
        <!-- <a href="#" id="id_bookmark" class="btn btn-outline-primary mr-2"><i class="far fa-bookmark"></i> Save</a> -->
        {% if activity.flyer  %}
        <a href="{{ activity.flyer.url }}" class="btn btn-outline-primary"><i class="fas fa-print"></i> Print flyer</a>
        {% endif %}
        {% if not activity.flyer %}
        <a href="#" class="btn btn-outline-primary disabled"><i class="fas fa-print"></i> Print flyer</a>
        {% endif %}
      </div>
      <div class="col-md-2 mt-4 mb-4">
        {% if user.is_authenticated %}
        <a href="{% url 'sms_create' activity.pk %}" target="_blank" class="btn btn-outline-primary float-right"><i class="fas fa-mobile-alt"></i></a>
        <a href="{% url 'email_create' activity.pk %}" target="_blank" class="btn btn-outline-primary float-right mr-2"><i class="far fa-envelope"></i></a>
        {% endif %}
      </div>
      <div class="col-md-3 mt-2 mb-2">
        {% if user.is_authenticated %}
        <button class="btn btn-lg disabled" style="width:95%;height:100%;">ATTEND</button>
        {% else %}
        <button class="btn btn-success btn-lg" style="width:95%;height:100%;">I'M COMING!</button>
        {% endif %}
      </div>
    </div>
  </row>

  <div class="card-body mt-4 ml-5">
    <div class="row">
      <div class="col-md-9 mt-4 mb-4">
        <h6 class="card-title">DESCRIPTION</h6>
        <p class="card-text" style="margin-bottom:5%;">{{ activity.description }}</p>
        <h6 class="card-title">ELIGIBILITY</h6>
        {% if activity.min_age and activity.max_age %}
          {{ activity.min_age }} to {{ activity.max_age }} years of age<br />
        {% endif %}

        {% if activity.max_age and not activity.min_age %}
          Maximum: {{ activity.max_age }} years old <br />
        {% endif %}

        {% if activity.min_age and not activity.max_age %}
          Minimum: {{ activity.min_age }} years old <br />
        {% endif %}

        {% if activity.background %} {{ activity.background }}<br />{% endif %}

        {% if activity.gender == 'B' %}Both females and males{% endif %}
        {% if activity.gender == 'F' %}Only females{% endif %}
        {% if activity.gender == 'M' %}Only males{% endif %}
        {% if activity.living_duration != 'Open' %}
        <p class="card-text" style="margin-bottom:5%;">Living in Australia for {{ activity.living_duration|lower }} than 5 years </p>      
        {% endif %}

        <h6 class="card-title mt-4">OTHER INFO</h6>
        <!--      Number of available spaces-->
        {% if activity.space_choice == 'Limited' %}
        <p class="card-text">Maximum space: {{ activity.space }} people</p>
        {% endif %}
        <!--      Activity cost-->
        {% if activity.cost_choice == 'N' %}Free of charge
        {% else %}Cost: AUD {{ activity.cost }}{% endif %}
      </div>

      <div class="col-md-3 mt-4">
        <h6 class="card-title">DATE AND TIME</h6>

        <!--    Activities that only occur once -->
        {% if activity.term == 'Once' %}
        {% if activity.activity_date %}
        <p class="card-text">{{ activity.activity_date|date:'D, d M Y' }}</p>
        {% endif %}
        {% endif %}

        <!--      Daily, weekly, fortnightly, monthly activities-->
        {% if activity.term != 'Once' %}
        {% if activity.term != 'Daily' %}
        <p class="card-text">Every {{ activity.activity_day }} from {{ activity.start_date|date:'D, d M Y' }} to {{ activity.end_date|date:'D, d M Y' }}</p>
        {% else %}
        <p class="card-text">Every day from {{ activity.start_date|date:'D, d M Y' }} to {{ activity.end_date|date:'D, d M Y' }}</p>
        {% endif %}
        {% endif %}

        <!--      Show the time of the activities-->
        <p class="card-text" style="margin-bottom:10%;">{{ activity.start_time|time:'g:i A' }} - {{ activity.end_time|time:'g:i A' }}</p>
        
        <h6 class="card-title">LOCATION</h6>
        {% if activity.location %}
        <p class="card-text" id="address">{{ activity.location }}</p>
        <p class="card-text small"><a href=# id="address2">Open in Google Maps</a></p>
        {% else %}
        <p class="card-text small"><i>Location hasn't been specified</i></p>
        {% endif %}

        <h6 class="card-title" style="margin-top:10%;">CONTACT ORGANISER</h6>
        {% if activity.organiser %}
        <p class="card-text">{{ activity.organiser }}&nbsp;{{ activity.contact_number }}</p>
        {% else %}
        <p class="card-text small"><i>Organiser contact hasn't been specified</i></p>
        {% endif %}

        {% if user.is_authenticated %}
        {% if activity.created_by == user %}
        <a href="{% url 'edit_activity' activity.pk %}" class="btn btn-block btn-success btn-lg mt-4">EDIT</a>
        {% else %}
        <a id="edit_btn" href="#" class="btn btn-block btn-success btn-lg mt-4" data-toggle="tooltip" data-placement="left" title="Only modifiable by activity organiser">EDIT</a>
        {% endif %}
        {% endif %}


      </div>

    </div>
  </div>
</div>
</div>

<br />

{% if activity.created_by.profile %}
<!-- Organisation description -->
<div class="container-fluid mt-6">
  <h3 class="text-center">{{ activity.created_by.profile.organisation_name }}</h3>
  <p class="text-center lead">{{ activity.created_by.profile.description }}</p>
</div>
{% endif %}

{% if org_activities %}
<!-- More activities from the same organisation -->
<div class="container-fluid mt-4">
  <h3 class="text-center" style="margin-top:10%;margin-bottom:2%;">More activities and events from this organiser</h3>
  <div class="container-fluid mt-4">
    <div class="multiple-items">
      {% for org_activity in org_activities %}
      <div class="card mr-2">
        {% if org_activity.activity_img %}
        <img class="card-img-top" src="{{ org_activity.activity_img.url }}" alt="Not Found" onerror="this.onerror=null;this.src='http://via.placeholder.com/350x300?text=Image not available';" style="object-fit:cover;height:200px;display:inline;">
        {% else %}
        <img class="card-img-top" src="http://via.placeholder.com/350x200?text=Image not available" alt="Not Found" style="object-fit: cover;display:inline;margin:auto;height:200px;">
        {% endif %}
        <div class="card-body">
        <p class="lead"><a href="{% url 'activity_detail' org_activity.pk %}">{{ org_activity.name }}</a></p>
        {% if org_activity.location %}<p class="card-text"> {{ org_activity.location }} </p>{% endif %}
        <!--    Activities that only occur once -->
        {% if org_activity.term == 'Once' %}
        {% if org_activity.activity_date %}
        <p class="card-text">{{ org_activity.activity_date|date:'D, d M Y'|upper }} - {{ org_activity.start_time|time:'g:i A' }}</p>
        {% endif %}
        {% endif %}

        <!--      Daily, weekly, fortnightly, monthly activities-->
        {% if org_activity.term != 'Once' %}
        {% if org_activity.term != 'Daily' %}
        <p class="card-text">Every {{ org_activity.activity_day }} - {{ org_activity.start_time|time:'g:i A' }}</p>
        {% else %}
        <p class="card-text">Every day - {{ org_activity.start_time|time:'g:i A' }}</p>
        {% endif %}
        {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}

<!-- Google Maps -->
{% if activity.location %}
<div class="container-fluid">
  <div class="row justify-content-center">
    <div id="map" style="margin-top:5%;"></div>
  </div>
</div>
{% endif %}

{% if recommended_activities %}
<!-- Other events and activities you may like -->
<div id="id_others" class="container-fluid mt-4 mb-0">
<h3 class="text-center" style="margin-top:2%;margin-bottom:2%;">Other events and activities you may like</h3>
<div class="container-fluid mt-4">
<div class="multiple-items">
  {% for recommended_activity in recommended_activities %}
  <div class="card mr-2">
    {% if recommended_activity.activity_img %}
    <img class="card-img-top" src="{{ recommended_activity.activity_img.url }}" alt="Not Found" onerror="this.onerror=null;this.src='http://via.placeholder.com/350x200?text=Image not available';" style="object-fit:cover;height:200px;display:inline;">
    {% else %}
    <img class="card-img-top" src="http://via.placeholder.com/350x300?text=Image not available" alt="Not Found" style="object-fit: cover;display:inline;margin:auto;height:200px;">
    {% endif %}
    <div class="card-body">
      <p class="lead"><a href="{% url 'activity_detail' recommended_activity.pk %}">{{ recommended_activity.name }}</a></p>
      {% if recommended_activity.location %}<p class="card-text"> {{ recommended_activity.location }} </p>{% endif %}
      
      <!--    Activities that only occur once -->
      {% if recommended_activity.term == 'Once' %}
      {% if recommended_activity.activity_date %}
      <p class="card-text">{{ recommended_activity.activity_date|date:'D, d M Y'|upper }} - {{ recommended_activity.start_time|time:'g:i A' }}</p>
      {% endif %}
      {% endif %}

      <!--      Daily, weekly, fortnightly, monthly activities-->
      {% if recommended_activity.term != 'Once' %}
      {% if recommended_activity.term != 'Daily' %}
      <p class="card-text">Every {{ recommended_activity.activity_day }} - {{ recommended_activity.start_time|time:'g:i A' }}</p>
      {% else %}
      <p class="card-text">Every day from {{ recommended_activity.start_date|date:'D, d M Y' }} - {{ recommended_activity.start_time|time:'g:i A' }}</p>
      {% endif %}
      {% endif %}
    </div>
  </div>
  {% endfor %}
</div>
</div>
</div>
{% endif %}

<!-- THE MODAL FOR SHARING URL -->
<div class="modal fade" id="modal-share-url">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Share the link</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div id="div_desktop" class="row mt-2" style="align-content:center;">
        <div id="share2" class="offset-md-3 mr-2"></div>
        <div id="share3" class="float-left mr-2"></div>
        <div class="jssocials send_dialog float-left mr-2">
            <div class="jssocials-shares">
            <div class="jssocials-share jssocials-share-messenger2">
                <button type="button" onclick="sendDialog(this.id)" target="_self" id="id_send_dialog" class="btn btn-primary send_dialog2" style="width:50px; height:40px;"><i class="fab fa-facebook-messenger fa-lg"></i></button>
            </div>
            </div>
        </div>
        <div id="share4" class="mr-2 share4 float-left"></div>
        <div id="share5" class="mr-2 share5 float-left"></div>
        <div id="share" class="mr-2 share float-left"></div>
      </div>
    <div class="row mt-2 ml-3 mr-1">
    <input style="width:85%;" class="form-control mr-2" readonly type="text" id="id_share_url" value="http://{{ domain }}{% url 'activity_detail' activity.pk %}">
    <button class="btn btn-outline-success" type="button" onclick="copyURL(this.id)" id="cpbtn"><i class="far fa-copy"></i></button>
    </div>
    <div class="row ml-3 mt-1">
    <p class="small" id="id_url_text"></p>
    </div>
    </div>
  </div>
</div>

{% endblock %}

{% block javascript %}
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDuR6-6PfCU7wRsSRRR3DH_PseEAYvyp3k&region=AU&callback=initMap">
</script>
<!-- <script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5a2f1bb7fce9e20013a73372&product=inline-share-buttons"></script> -->

<!-- Go to www.addthis.com/dashboard to customize your tools -->
<!-- <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a435c987240088a"></script> -->
<script defer src="https://use.fontawesome.com/releases/v5.0.2/js/all.js"></script>

<script src="{% static 'js/jssocials.js' %}"></script>
<script src="{% static 'js/slick.js' %}"></script>

<!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.min.js"></script> -->
<script>
  // Show the map
  setTimeout(function initMap() {
    var geocoder = new google.maps.Geocoder();
    var map = new google.maps.Map(document.getElementById('map'));
    
    // Populate addresses from GMaps on address input
    var address = $('#address').text();
    geocodeAddress(geocoder, map);

    // Populate GMaps URL on the address link
    var map_url = "https://www.google.com/maps/search/?api=1&query=";
    var full_url = map_url + address;
    $("#address2").attr("href", full_url);
  }, 1000);

  function geocodeAddress(geocoder, resultsMap) {
    var address = $('#address').text();
    // var address = 'Southern Cross Station';
    // alert(address);
    geocoder.geocode({'address': address}, function(results, status) {
      if (status === 'OK') {
        resultsMap.setCenter(results[0].geometry.location);
        resultsMap.setZoom(14);
        var marker = new google.maps.Marker({
          map: resultsMap,
          position: results[0].geometry.location
        });
      }
    });
  }
  // google.maps.event.addDomListener(window, 'page:load', initMap);


  $("#share").jsSocials({
      shares: ["messenger"],
      showLabel: false,
      shareIn: "popup",
      url: window.location.hostname+"{% url 'activity_detail' activity.pk %}",
  });
  $("#share2").jsSocials({
      shares: ["facebook"],
      showLabel: false,
      shareIn: "popup",
  });
  $("#share3").jsSocials({
      shares: ["email"],
      showLabel: false,
      shareIn: "popup",
  });
  $("#share4").jsSocials({
      shares: ["whatsapp"],
      showLabel: false,
      shareIn: "popup",
  });
  $("#share5").jsSocials({
      shares: ["sms"],
      showLabel: false,
      shareIn: "popup",
  });

  window.fbAsyncInit = function() {
    FB.init({
      appId            : '1943348669252986',
      autoLogAppEvents : true,
      xfbml            : true,
      version          : 'v2.11'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));

  //  $("#id_send_dialog").click(sendDialog);

  function sendDialog() {
    FB.ui({
      method: 'send',
      link: window.location.href
    });
  }

function copyURL() {
  var copyText = document.getElementById("id_share_url");
  copyText.select();
  document.execCommand("Copy");
  $("#id_url_text").html("Link has been copied!");
}

function markActivity(clicked_id) {
    var url_dest = '/activity/bookmark/'+clicked_id+'/'
    $.ajax({
        url: url_dest,
        type: 'get',
        dataType: 'json',
        beforeSend: function () {
            // alert(url_dest);
        },
        success: function(){
          $(this).toggleClass('active');
        }
    });
};

$(function() {
  $('.multiple-items').slick({
    infinite: true,
    slidesToShow: 3,
    slidesToScroll: 1,
    focusOnSelect: true,
    mobileFirst: true,
    responsive: [
    {
      breakpoint: 1024,
      settings: {
        slidesToShow: 3,
        slidesToScroll: 1,
        infinite: true
        // dots: true
      }
    },
    {
      breakpoint: 600,
      settings: {
        slidesToShow: 2,
        slidesToScroll: 1
      }
    },
    {
      breakpoint: 300,
      settings: {
        slidesToShow: 1,
        slidesToScroll: 1
      }
    }
    // You can unslick at a given breakpoint now by adding:
    // settings: "unslick"
    // instead of a settings object
    ],
    prevArrow: "<button type=\"button\" class=\"slick-prev\"><i class=\"fas fa-arrow-left\"></i></button>"
  });

  // Change apperance of bookmark button when clicked
  $( ".active" ).each(function() {
    $( this ).siblings('.remove').css( "display", "none" );
  });

  $('#edit_btn').tooltip();

  var isMobile = window.matchMedia("only screen and (max-width: 760px)");

  if (isMobile.matches) {
    $(".send_dialog").hide();
  }
  else{
    $("#share").hide();
    $("#share4").hide();
    $("#share5").hide();
  }

  $(".js-share-url").click(function () {
    $("#id_url_text").html("");
    $("#modal-share-url").modal("show");
  });

});
</script>

{% endblock %}
