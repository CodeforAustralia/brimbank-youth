{% extends 'base.html' %}

{% load social_share %}

{% block title %}{{ activity.name }}{% endblock title %}

{% block stylesheet %}
<style>
    #map {
        height: 400px;
        width: 80%;
   }
</style>
{% endblock %}

{% block content %}
<div class="card">
  <div class="card-body">
    <h4 class="card-title"><a href="{% url 'activity_detail' activity.pk %}">{{ activity.name }}</a></h4>
    <p class="card-text">{{ activity.description }}</p>
    <p class="card-text">{{ activity.activity_type }}</p>
    <p class="card-text">{{ activity.organiser }}</p>
    <p class="card-text">Where? <a href=# id="address">{{ activity.location }}</a></p>  
    
      
<!--    Activities that only occur once -->
    {% if activity.activity_date %}
        <p class="card-text">{{ activity.activity_date|date:'D, d M Y' }}</p>
        <p class="card-text">{{ activity.start_time|time:'g:i A' }} to {{ activity.end_time|time:'g:i A' }}</p>
    {% endif %}
    
<!--      Daily, weekly, fortnightly, monthly activities-->
    {% if activity.term != 'Once' %}
      {% if activity.activity_day %}
      <p class="card-text">Happening every {{ activity.activity_day }} from {{ activity.start_date|date:'D, d M Y' }} to {{ activity.end_date|date:'D, d M Y' }}</p>
      {% else %}
      <p class="card-text">Happening every day from {{ activity.start_date|date:'D, d M Y' }} to {{ activity.end_date|date:'D, d M Y' }}</p>
      {% endif %}
      
<!--      Show the time of the activities-->
      <p class="card-text">{{ activity.start_time|time:'g:i A' }} to {{ activity.end_time|time:'g:i A' }}</p>
    {% endif %}
      
    <!--      Number of available spaces-->
      {% if activity.space_choice == 'Limited' %}
        <p class="card-text">Available space: {{ activity.space }}</p>
      {% endif %}
      
<!--      Activity cost-->
      {% if activity.cost_choice == 'N' %}
        <p class="card-text">No cost</p>
      {% endif %}
      {% if activity.cost_choice == 'Y' %}
        <p class="card-text">Cost: ${{ activity.cost }}</p>
      {% endif %}
      
<!--      Eligibility-->
      {% if activity.living_duration != 'Open' %}
      <p class="card-text">Living in Australia {{ activity.living_duration|lower }} than 5 years </p>      
      {% endif %}
      
      {% if activity.living_duration == 'Open' %}
      <p class="card-text">Open to anyone</p>
      {% endif %}
      
    {% if user.is_authenticated %}
    <a href="{% url 'sms_create' activity.pk %}" class="btn btn-outline-primary">Send SMS</a>
    <a href="{% url 'email_create' activity.pk %}" class="btn btn-outline-primary">Send Email</a>
    <a class="col-sm-2 col-sm-4">
        <a href="{% url 'edit_activity' activity.pk %}" class="btn btn-outline-primary">Edit</a>
        <a href="{% url 'create_activity' %}" class="btn btn-primary"> Create another </a>
        <a class="btn btn-danger" data-method="delete" href="{% url 'delete_activity' activity.id %}">Delete</a>
    </a>
    {% endif %}
      
  </div>
</div>

<br />

{% if not user.is_authenticated %}
<div class="sharethis-inline-share-buttons"></div>
<!-- {% post_to_facebook '' %}
    
{% send_email activity.name "New activity: {{activity.name}}. Check it out!" "" %} -->

{% endif %}

{% if activity.location %}
<div class="row justify-content-center">
  <div id="map"></div>
</div>
{% endif %}

{% endblock %}

{% block javascript %}
<script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5a2f1bb7fce9e20013a73372&product=inline-share-buttons"></script>

<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDuR6-6PfCU7wRsSRRR3DH_PseEAYvyp3k&callback=initMap">
</script>

<script>
  function initMap() {
  var geocoder = new google.maps.Geocoder();

  var map = new google.maps.Map(document.getElementById('map'));

  var address = $('#address').text();

  geocodeAddress(geocoder, map);

  var map_url = "https://www.google.com/maps/search/?api=1&query=";
  var full_url = map_url + address;

  $("#address").attr("href", full_url);

}

function geocodeAddress(geocoder, resultsMap) {
  var address = $('#address').text();
  // var address = 'Southern Cross Station';
  // alert(address);
  geocoder.geocode({'address': address}, function(results, status) {
    if (status === 'OK') {
      resultsMap.setCenter(results[0].geometry.location);
      resultsMap.setZoom(14);
      var marker = new google.maps.Marker({
        map: resultsMap,
        position: results[0].geometry.location
      });
    } 
    
    // else {
    //   $('#map').hide();
    // }
  });
}
</script>
{% endblock %}
